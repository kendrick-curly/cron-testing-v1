name: Daily Test Branch Check

on:
  schedule:
    # 6pm PHT = 10am UTC
    - cron: "0 10 * * 1-5"
  workflow_dispatch:

jobs:
  check-testing-branch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout testing branch
        uses: actions/checkout@v4
        with:
          ref: testing
          fetch-depth: 0   # needed for tag and history checks
          lfs: true

      - name: Check if commit has a tag
        id: tagcheck
        run: |
          if git describe --tags --exact-match >/dev/null 2>&1; then
            TAG=$(git describe --tags --exact-match)
            echo "Found tag: $TAG"
          else
            echo "::error::‚ùå This commit has NO TAG. Builds require a tag when using versioning: Tag."
            exit 1
          fi

      - name: Run CommitsWithinTime script
        uses: AlexStormwood/CommitsWithinTime@v1.1.12
        id: commitswithintime
        with:
          hours: 0
          minutes: 0
          seconds: 5

      # Use the output from the `commitswithintime` step
      - name: Get the output from CommitsWithinTime
        run: |
          echo "The 'has-new-commits-within-time' value is ${{ steps.commitswithintime.outputs.has-new-commits-within-time }}"
          echo "The 'number-of-commits-within-time' value is ${{ steps.commitswithintime.outputs.number-of-commits-within-time }}"
          echo "The 'total-commits' value is ${{ steps.commitswithintime.outputs.total-commits }}"

      - name: Exit early if no new commits detected
        if: ${{ steps.commitswithintime.outputs.has-new-commits-within-time == 'false' }}
        run: |
          echo "No new commits within the specified time window. Exiting."
          exit 0

      - name: success
        if: ${{ steps.commitswithintime.outputs.has-new-commits-within-time == 'true' }}
        run: echo "success"
